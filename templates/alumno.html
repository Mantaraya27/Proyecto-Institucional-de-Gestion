<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>Panel de Administración</title>
    <style>
      /* Estilos generales y de la barra lateral */
      body {
          font-family: Arial, sans-serif;
          margin: 0;
          padding: 0;
          display: flex;
          height: 100vh;
          background-color: rgb(43, 36, 36);
          overflow: hidden;
      }

      .sidebar {
          width: 250px;
          background-color: {{ '#690325' if espe== 'Informatica' else '#61513f' if espe == 'Construccion civil' else '#0b0e30' if espe == 'Automotriz' else '#424242' if espe == 'Electrónica' else '#a6a29c' if espe == 'Química' else '#0b45a1' if espe == 'Electromecanica' else '#0a2e0d' if espe == 'Mecánica Industrial' else '#198094' if espe == 'Electricidad'}};
          color: rgb(255, 255, 255);
          height: 100%;
          padding: 20px;
          box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
          position: fixed;
          transition: transform 0.3s ease;
      }

      .sidebar.closed {
          transform: translateX(-250px);
      }

      .sidebar h2 {
          text-align: center;
          font-size: 1.5em;
          margin-top: 0;
      }

      .sidebar ul {
          list-style: none;
          padding: 0;
          font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif
      }

      .sidebar ul li {
          margin: 20px 0;
      }

      .formTitle {
          color: white;
      }

      .sidebar ul li a {
          color: white;
          text-decoration: none;
          font-weight: bold;
          display: block;
          padding: 10px;
          border-radius: 5px;
          transition: background-color 0.3s;
          display: flex;
          align-items: center;
      }

      .sidebar ul li a i {
          margin-right: 10px;
      }

      .sidebar ul li a:hover {
          background-color: {{ '#300111' if espe=='Informatica' else '#362c21' if espe== 'Construccion civil' else '#050717' if espe == 'Automotriz' else '#212121' if espe == 'Electrónica' else '#6e6b67' if espe == 'Química' else '#072a61' if espe == 'Electromecanica' else '#030d03' if espe == 'Mecánica Industrial' else '#0e4752' if espe == 'Electricidad'}};
      }

      .formTitle {
          color: white;
      }

      /* Estilos del contenido */
      .content {
          margin-left: 270px;
          flex-grow: 1;
          padding: 20px;
          overflow-y: auto;
          width: calc(100% - 270px);
          transition: margin-left 0.3s ease;
          display: flex;
          flex-direction: row;
      }

      /* Estilos de la barra superior */
      .top-bar {
          margin-left: 0;
          color: #ecd9d9;
          padding: 10px 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;

      }

      .top-bar .menu-icon {
          cursor: pointer;
          font-size: 24px;
          color: white;
      }

      .top-bar .profile {
          display: flex;
          align-items: center;
      }

      .top-bar .profile img {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          margin-left: 10px;
      }

      /* Estilos del formulario y botones */
      .form-container {
          width: 40%;
          margin-left: 20px;
          padding-left: 20px;
          background-color: rgb(43, 36, 36);
          box-shadow: 0 0 10px rgba(202, 82, 82, 0.1);
          border-radius: 8px;
          margin-right: 20px;
          transition: width 0.3s ease;
      }

      .form-container h1 {
          color: #eeecec;
          text-align: center;
      }

      .contact-form input[type="text"],
      .contact-form select {
          display: flex;
          width: 80%;
          gap: 10px;
          margin: 20px 0;
          padding: 10px;
          border: 1px solid #2b2727;
          border-radius: 4px;
          background-color: #ebd6d6;
      }

      .contact-form input[type="email"],
      .contact-form select {
          display: flex;
          width: 80%;
          gap: 10px;
          margin: 20px 0;
          padding: 10px;
          border: 1px solid #2b2727;
          border-radius: 4px;
          background-color: #ebd6d6;
      }

      .contact-form button {
          padding: 10px;
          width: 100px;
          margin-left: 38%;
          background-color: {{ '#92024a' if espe=='Informatica' else '#b89874' if espe == 'Construccion civil' else '#161d5c' if espe == 'Automotriz' else '#7a7a7a' if espe == 'Electrónica' else '#ffffff' if espe == 'Química' else '#0e65f0' if espe == 'Electromecanica' else '#155c1b' if espe == 'Mecánica Industrial' else '#27c4e3' if espe == 'Electricidad'}};
          color: {{ '#000000' if espe == 'Química' else '#ffffff' }};
          border: none;
          border-radius: 4px;
          cursor: pointer;
      }

      .contact-form button:hover {
          background-color: {{ '#690325' if espe== 'Informatica' else '#61513f' if espe == 'Construccion civil' else '#0b0e30' if espe == 'Automotriz' else '#424242' if espe == 'Electrónica' else '#a6a29c' if espe == 'Química' else '#0b45a1' if espe == 'Electromecanica' else '#0a2e0d' if espe == 'Mecánica Industrial' else '#198094' if espe == 'Electricidad'}};
      }


      #email {
          width: 100%;
          padding: 10px;
          border: 1px solid #2b2727;
          border-radius: 4px;
          background-color: #ebd6d6;
          font-size: 14px;
          color: #333333;
      }

      .form-buttons {
          display: flex;
          justify-content: center;
          gap: 10px;
          margin-bottom: 20px;
      }

      .form-buttons button {
          padding: 10px 20px;
          background-color: {{ '#92024a' if espe=='Informatica' else '#b89874' if espe == 'Construccion civil' else '#161d5c' if espe == 'Automotriz' else '#7a7a7a' if espe == 'Electrónica' else '#ffffff' if espe == 'Química' else '#0e65f0' if espe == 'Electromecanica' else '#155c1b' if espe == 'Mecánica Industrial' else '#27c4e3' if espe == 'Electricidad'}};
          color: {{ '#000000' if espe == 'Química' else '#ffffff' }};
          border: none;
          border-radius: 4px;
          cursor: pointer;
          transition: transform 0.3s;
      }

      .form-buttons button:hover {
          background-color: {{ '#690325' if espe== 'Informatica' else '#61513f' if espe == 'Construccion civil' else '#0b0e30' if espe == 'Automotriz' else '#424242' if espe == 'Electrónica' else '#a6a29c' if espe == 'Química' else '#0b45a1' if espe == 'Electromecanica' else '#0a2e0d' if espe == 'Mecánica Industrial' else '#198094' if espe == 'Electricidad'}};
          transform: scale(1.05);
      }

      .form-buttons button.active {
          background-color: {{ '#92024a' if espe=='Informatica' else '#b89874' if espe == 'Construccion civil' else '#161d5c' if espe == 'Automotriz' else '#7a7a7a' if espe == 'Electrónica' else '#ffffff' if espe == 'Química' else '#0e65f0' if espe == 'Electromecanica' else '#155c1b' if espe == 'Mecánica Industrial' else '#27c4e3' if espe == 'Electricidad'}};
      }

      .form-buttons button.active:hover {
          background-color: {{ '#690325' if espe== 'Informatica' else '#61513f' if espe == 'Construccion civil' else '#0b0e30' if espe == 'Automotriz' else '#424242' if espe == 'Electrónica' else '#a6a29c' if espe == 'Química' else '#0b45a1' if espe == 'Electromecanica' else '#0a2e0d' if espe == 'Mecánica Industrial' else '#198094' if espe == 'Electricidad'}};
          transform: scale(1.05);
      }

      /* Estilos de la tabla */
      .list-container {
          width: 60%;
      }

      table {
          width: 100%;
          border-collapse: collapse;
          margin: 20px 0;
          background-color: rgb(48, 45, 45);
      }

      table,
      th,
      td {
          border: 1px solid {{ '#690325' if espe== 'Informatica' else '#61513f' if espe == 'Construccion civil' else '#0b0e30' if espe == 'Automotriz' else '#424242' if espe == 'Electrónica' else '#a6a29c' if espe == 'Química' else '#0b45a1' if espe == 'Electromecanica' else '#0a2e0d' if espe == 'Mecánica Industrial' else '#198094' if espe == 'Electricidad'}};
          ;
      }

      td {
          color: rgb(247, 226, 226);
      }

      th,
      td {
          padding: 10px;
          text-align: left;
      }

      th {
          background-color: {{ '#690325' if espe== 'Informatica' else '#61513f' if espe == 'Construccion civil' else '#0b0e30' if espe == 'Automotriz' else '#424242' if espe == 'Electrónica' else '#a6a29c' if espe == 'Química' else '#0b45a1' if espe == 'Electromecanica' else '#0a2e0d' if espe == 'Mecánica Industrial' else '#198094' if espe == 'Electricidad'}};
          color: #fff;
      }

      /* Estilos de la barra de búsqueda */
      .barra {
          background-color: {{ '#92024a' if espe=='Informatica' else '#b89874' if espe == 'Construccion civil' else '#161d5c' if espe == 'Automotriz' else '#7a7a7a' if espe == 'Electrónica' else '#ffffff' if espe == 'Química' else '#0e65f0' if espe == 'Electromecanica' else '#155c1b' if espe == 'Mecánica Industrial' else '#27c4e3' if espe == 'Electricidad'}};
          color: white;
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 20px;
          border-radius: 18px;
      }

      .barra h2 {
          margin: 0;
          padding-bottom: 20px;
          color: {{ '#000000' if espe == 'Química' else '#ffffff' }};
      }

      .barra input[type="text"] {
          width: 80%;
          padding: 10px;
          border: none;
          border-radius: 4px;
          font-size: 14px;
          color: #333333;
          outline: none;
          background-color: #f2f2f2;
          margin-bottom: 20px;
      }

      .barra button {
          padding: 10px 20px;
          background-color: {{ '#92024a' if espe=='Informatica' else '#b89874' if espe == 'Construccion civil' else '#161d5c' if espe == 'Automotriz' else '#7a7a7a' if espe == 'Electrónica' else '#ffffff' if espe == 'Química' else '#0e65f0' if espe == 'Electromecanica' else '#155c1b' if espe == 'Mecánica Industrial' else '#27c4e3' if espe == 'Electricidad'}};
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          transition: background-color 0.3s;
      }

      .barra button:hover {
          background-color: #7e083f;
      }

      .search-container {
          position: relative;
          width: 80%;
          margin-bottom: 20px;
      }

      .search-container input[type="text"] {
          width: 100%;
          padding: 10px 10px 10px 40px;
          /* Ajuste de padding para espacio del icono */
          border: none;
          border-radius: 4px;
          font-size: 14px;
          color: #333333;
          background-color: #f2f2f2;
      }

      .search-container .fas.fa-search {
          position: absolute;
          top: 34%;
          left: 10px;
          transform: translateY(-50%);
          color: #666666;
      }

      .active {
          background-color: yellow;
      }





      @media (max-width: 768px) {
          .sidebar {
              width: 100%;
              height: auto;
              position: relative;
              transform: none;
          }

          .sidebar.closed {
              transform: none;
          }

          .content {
              margin-left: 0;
              width: 100%;
          }

          .form-container {
              width: 100%;
              padding: 10px;
              margin: 10px 0;
          }

          .list-container {
              width: 100%;
              margin: 10px 0;
          }

          .top-bar {
              flex-direction: column;
              align-items: flex-start;
          }

          .top-bar .profile {
              margin-top: 10px;
          }
      }

      @media (max-width: 480px) {

          .contact-form input[type="text"],
          .contact-form select {
              width: calc(100% - 10px);
              margin: 5px;
              padding: 8px;
          }

          .contact-form button {
              padding: 8px;
              width: 80px;
          }

          .form-buttons button {
              padding: 8px 16px;
          }
      }
    </style>
  </head>

  <body>
    <div class="sidebar">
      <h2>Admin Panel</h2>
      <ul>
        <li>
          <a href="{{ url_for('admin', espe=espe) }}"
            ><i class="fa fa-home"></i> Inicio</a
          >
        </li>
        <li>
          <a href="#"><i class="fa fa-question-circle"></i> Soporte</a>
        </li>
        <li>
          <a href="{{ url_for('logout') }}"
            ><i class="fa fa-sign-out-alt"></i> Cerrar Sesión</a
          >
        </li>
      </ul>
    </div>

    <div class="content">
      <div class="form-container">
        <div class="top-bar">
          <i class="fa fa-bars menu-icon" onclick="toggleSidebar()"></i>
          <div class="profile">
            <span>Bienvenido, {{ session['role'].capitalize() }}</span>
            <img src="https://via.placeholder.com/40" alt="Foto de Perfil" />
          </div>
        </div>

        <div class="form-buttons">
          <button onclick="setFormMode('add')" class="active">Agregar</button>
          <button onclick="setFormMode('edit')">Modificar</button>
          <button onclick="setFormMode('delete')">Eliminar</button>
        </div>

        <form
        <form
        id="studentForm"
        action="{{ url_for('add_contact') }}"
        method="POST"
        class="contact-form"
      >
        <h1 class="formTitle"></h1>
        <input type="hidden" name="form_mode" id="form_mode" value="add" />
        <input type="hidden" name="espe" id="espe" value="{{ espe }}" />
        
        <div id="ciField">
          <p class="formTitle">Número de cédula</p>
          <input
            type="text"
            name="ci"
            id="ci"
            placeholder="CI"
            required
            oninput="this.value = this.value.replace(/[^0-9]/g, ''); loadStudentData()"
          />
        </div>
        
        <div id="otherFields" style="display:none;">
          <input
            type="text"
            name="nombre"
            id="nombre"
            placeholder="Nombre"
            oninput="this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚáéíóúñÑ\s]/g, '');"
            required
          />
          <input
            type="text"
            name="apellido"
            id="apellido"
            placeholder="Apellido"
            oninput="this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚáéíóúñÑ\s]/g, '');"
            required
          />
          <p class="formTitle">Curso</p>
          <select name="curso" id="curso" required>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
          </select>
          <p class="formTitle">Sección</p>
          <select name="seccion" id="seccion" required>
            {% if espe == 'Química' or espe == 'Construccion civil' or espe == 'Electricidad' or espe == 'Electrónica' %}
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            {% else %}
            <option value="1">1</option>
            <option value="2">2</option>
            {% endif %}
          </select>
          <p class="formTitle">Cantidad correo</p>
          <select id="cantidadCorreo" name="cantidadCorreo">
            <option value="1">1</option>
            <option value="2">2</option>
          </select>
          <p class="formTitle">Correo Electronico encargado</p>
          <input type="email" name="correo_encargado" id="correo_encargado" required />
          <div id="extraCorreo"></div>
        </div>
        
        <input
          type="hidden"
          id="current_ci"
          name="current_ci"
          value="{{ current_ci_value }}"
          oninput="this.value = this.value.replace(/[^0-9]/g, '');"
        />
      
        <button type="submit" onclick="validar_alumno(event)">Enviar</button>
      </form>
      


        <form
          id="deleteForm"
          action="{{ url_for('delete_contact') }}"
          method="POST"
          class="contact-form"
          style="display: none"
        >
          <h1 id="formTitleDelete">Eliminar Alumno</h1>
          <input
            type="hidden"
            name="form_mode"
            id="form_mode_delete"
            value="delete"
          />
          <input type="hidden" name="espe" id="espe" value="{{ espe }}" />
          <input
            type="text"
            name="ci"
            id="ci_delete"
            placeholder="CI"
            oninput="this.value = this.value.replace(/[^0-9]/g, '');"
          />

          <button
            type="submit"
            id="deleteButton"
            onclick="confirmarEliminacion(event)"
          >
            Enviar
          </button>
        </form>
      </div>

      <div class="list-container">
        <div class="barra">
          <h2 align="center">Lista de Alumnos</h2>
          <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" id="busqueda" placeholder="Buscar..." />
          </div>
        </div>

        <table id="tablaAlumnos">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Apellido</th>
              <th>Curso</th>
              <th>Sección</th>
              <th>Especialidad</th>
              <th>CI</th>
              <th>Email</th>
              <th>Email 2</th>
            </tr>
          </thead>
          <tbody>
            {% for alumno in alumnos %}
            <tr>
              <td>{{ alumno[1] }}</td>
              <td>{{ alumno[2] }}</td>
              <td>{{ alumno[3] }}</td>
              <td>{{ alumno[4] }}</td>
              <td>{{ alumno[5] }}</td>
              <td>{{ alumno[6] }}</td>
              <td>{{ alumno[7] }}</td>
              <td>{{ alumno[8] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <script>
      document
        .getElementById("busqueda")
        .addEventListener("input", function () {
          var filter = this.value.toUpperCase(); // Captura el valor del input y lo convierte a mayúsculas
          var rows = document.querySelectorAll("#tablaAlumnos tbody tr"); // Selecciona todas las filas en el tbody de la tabla

          rows.forEach(function (row) {
            // Captura el contenido de cada celda específica en la fila
            var nombre = row
              .querySelector("td:nth-child(1)")
              .textContent.toUpperCase();
            var apellido = row
              .querySelector("td:nth-child(2)")
              .textContent.toUpperCase();
            var curso = row
              .querySelector("td:nth-child(3)")
              .textContent.toUpperCase();
            var seccion = row
              .querySelector("td:nth-child(4)")
              .textContent.toUpperCase();
            var especialidad = row
              .querySelector("td:nth-child(5)")
              .textContent.toUpperCase();
            var ci = row
              .querySelector("td:nth-child(6)")
              .textContent.toUpperCase();
            var email = row
              .querySelector("td:nth-child(7)")
              .textContent.toUpperCase();

            // Compara el valor de búsqueda con el contenido de las celdas
            if (
              nombre.includes(filter) ||
              apellido.includes(filter) ||
              curso.includes(filter) ||
              seccion.includes(filter) ||
              especialidad.includes(filter) ||
              ci.includes(filter) ||
              email.includes(filter)
            ) {
              row.style.display = ""; // Muestra la fila si coincide con el filtro
            } else {
              row.style.display = "none"; // Oculta la fila si no coincide con el filtro
            }
          });
        });
      // Función para mostrar/ocultar la barra lateral
      function toggleSidebar() {
        const sidebar = document.querySelector(".sidebar");
        sidebar.classList.toggle("closed");
      }
      document.getElementById('cantidadCorreo').addEventListener('change', function() {
            var extraCorreoDiv = document.getElementById('extraCorreo');
            extraCorreoDiv.innerHTML = ''; // 清空之前的内容

            console.log("Cambio detectado. Valor seleccionado:", this.value); // 调试信息

            if (this.value == '2') {
                console.log("添加第二个 Correo Electronico encargado"); // 调试信息

                var newTitle = document.createElement('p');
                newTitle.className = 'formTitle';
                newTitle.textContent = 'Correo Electronico encargado';

                var newInput = document.createElement('input');
                newInput.type = 'email';
                newInput.name = 'correo_encargado_2';
                newInput.id = 'correo_encargado_2';
                newInput.required = true;

                extraCorreoDiv.appendChild(newTitle);
                extraCorreoDiv.appendChild(newInput);
            }
        });

     // Función para cambiar entre modos de formulario (Agregar, Modificar, Eliminar)
function setFormMode(mode) {
  console.log("setFormMode called with mode:", mode);

  const form = document.getElementById("studentForm");
  const deleteForm = document.getElementById("deleteForm");

  if (!form || !deleteForm) {
    console.error("Form or deleteForm not found");
    return;
  }

  const formTitle = document.querySelector(".formTitle");
  const formModeInput = document.getElementById("form_mode");
  const formTitleDelete = document.getElementById("formTitleDelete");
  const formModeInputDelete = document.getElementById("form_mode_delete");

  const addButton = document.querySelector(".form-buttons button:nth-child(1)");
  const editButton = document.querySelector(".form-buttons button:nth-child(2)");
  const deleteButton = document.querySelector(".form-buttons button:nth-child(3)");

  form.reset();
  deleteForm.reset();

  if (mode === "add") {
    form.style.display = "block";
    deleteForm.style.display = "none";
    form.action = "{{ url_for('add_contact') }}";
    formTitle.innerText = "Agregar Alumno";
    formModeInput.value = "add";

    // Mostrar todos los campos necesarios para agregar un nuevo alumno
    document.getElementById("ciField").style.display = "block";
    document.getElementById("otherFields").style.display = "block";
    document.getElementById("extraCorreo").style.display = "none";

    // Limpiar campos
    document.getElementById("ci").value = "";
    document.getElementById("nombre").value = "";
    document.getElementById("apellido").value = "";
    document.getElementById("curso").value = "";
    document.getElementById("seccion").value = "";
    document.getElementById("cantidadCorreo").value = "1";
    document.getElementById("correo_encargado").value = "";
    document.getElementById("extraCorreo").innerHTML = "";

    addButton.classList.add("active");
    editButton.classList.remove("active");
    deleteButton.classList.remove("active");
  } else if (mode === "edit") {
    form.style.display = "block";
    deleteForm.style.display = "none";
    form.action = "{{ url_for('edit_contact') }}";
    formTitle.innerText = "Modificar Alumno";
    formModeInput.value = "edit";

    // Solo mostrar el campo de CI al inicio
    document.getElementById("ciField").style.display = "block";
    document.getElementById("otherFields").style.display = "none";
    document.getElementById("extraCorreo").style.display = "none";

    addButton.classList.remove("active");
    editButton.classList.add("active");
    deleteButton.classList.remove("active");
  } else if (mode === "delete") {
    form.style.display = "none";
    deleteForm.style.display = "block";
    formTitleDelete.innerText = "Eliminar Alumno";
    formModeInputDelete.value = "delete";

    addButton.classList.remove("active");
    editButton.classList.remove("active");
    deleteButton.classList.add("active");
  }
}

// Función para manejar la visibilidad del campo adicional de correo electrónico
function handleCorreoCountChange() {
  const cantidadCorreo = document.getElementById("cantidadCorreo").value;
  const extraCorreoDiv = document.getElementById("extraCorreo");

  if (cantidadCorreo === "2") {
    extraCorreoDiv.style.display = "block";
    if (!document.getElementById("correo_encargado2")) {
      extraCorreoDiv.innerHTML = `
        <p class="formTitle">Correo Electrónico Adicional</p>
        <input type="email" name="correo_encargado2" id="correo_encargado2" />
      `;
    }
  } else {
    extraCorreoDiv.style.display = "none";
  }
}

// Asignar el evento change al campo de "Cantidad de correos"
document.getElementById("cantidadCorreo").addEventListener("change", handleCorreoCountChange);

// Llamada a setFormMode para mostrar el modo de agregar por defecto al cargar la página
window.onload = function() {
  setFormMode("add");
};


 

  function loadStudentData() {
    const ci = document.getElementById("ci").value;

    if (ci && document.getElementById("form_mode").value === "edit") {
      fetch(`/get_student_data?ci=${ci}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          if (data.error) {
            console.error("Error loading student data:", data.error);
            return;
          }

          document.getElementById("otherFields").style.display = "block";
          document.getElementById("extraCorreo").style.display = data.correo_encargado2 ? "block" : "none";

          document.getElementById("nombre").value = data.nombre || '';
          document.getElementById("apellido").value = data.apellido || '';
          document.getElementById("curso").value = data.curso || '';
          document.getElementById("seccion").value = data.seccion || '';
          document.getElementById("correo_encargado").value = data.correo_encargado || '';

          const extraCorreoDiv = document.getElementById("extraCorreo");
          extraCorreoDiv.innerHTML = '';
          if (data.correo_encargado2) {
            extraCorreoDiv.innerHTML = `
              <p class="formTitle">Correo Electrónico Adicional</p>
              <input type="email" name="correo_encargado2" id="correo_encargado2" value="${data.correo_encargado2 || ''}" />
            `;
          }
        })
        .catch(error => {
          console.error("Error loading student data:", error);
        });
    }
  }

  // Asignar el evento input al campo C.I. para cargar datos en modo de edición
  document.getElementById("ci").addEventListener("input", loadStudentData);





      function validar_campos_vacios() {
        const nombre = document.getElementById("nombre").value.trim();
        const apellido = document.getElementById("apellido").value.trim();
        const ci = document.getElementById("ci").value.trim();
        
        // Solo valida `correo_encargado_2` si está presente en el DOM
        const correoEncargado2 = document.getElementById("correo_encargado_2");
        const currentCi = correoEncargado2 && correoEncargado2.value.trim();

        if (!nombre || !apellido || !ci || (correoEncargado2 && !currentCi)) {
          Swal.fire({
            icon: "error",
            title: "Campos vacíos",
            text: "Todos los campos son obligatorios.",
            timer: 3000,
            timerProgressBar: true,
            showConfirmButton: false,
          });
          return false;
        }
        return true;
      }


      function validarEmail(email) {
        const emailPattern = /^[^\s@]+@[^\s@]+\.(com)$/; // Permite .com, .org, .net, .edu
        return emailPattern.test(email);
      }
      function validar_nombre_apellido() {
        const nombre = document.getElementById("nombre").value.trim();
        const apellido = document.getElementById("apellido").value.trim();

        // Expresión regular para detectar números
        const numeroRegex = /\d/;

        // Validar que el nombre no contenga números
        if (numeroRegex.test(nombre)) {
          Swal.fire({
            icon: "error",
            title: "Nombre inválido",
            text: "El nombre no puede contener números.",
            timer: 3000,
            timerProgressBar: true,
          });
          return false;
        }

        // Validar que el apellido no contenga números
        if (numeroRegex.test(apellido)) {
          Swal.fire({
            icon: "error",
            title: "Apellido inválido",
            text: "El apellido no puede contener números.",
            timer: 3000,
            timerProgressBar: true,
          });
          return false;
        }

        // Validar que el nombre no sea igual al apellido (ignora mayúsculas y minúsculas)
        if (nombre.toLowerCase() === apellido.toLowerCase()) {
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "El nombre y el apellido no pueden ser iguales.",
            timer: 3000,
            timerProgressBar: true,
            showConfirmButton: false,
          });
          return false;
        }
        return true;
      }
      async function confirmarEliminacion(event) {
        // Evita el comportamiento predeterminado del botón si se usa `event`
        if (event) event.preventDefault();

        const ci = document.getElementById("ci_delete").value.trim();
        const espe = document.getElementById("espe").value.trim(); // Obtén el valor de 'espe'

        // Verifica que el CI no esté vacío, sea numérico y tenga entre 7 y 8 caracteres
        if (!ci || isNaN(ci) || ci.length < 7 || ci.length > 8) {
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "Por favor, ingrese un CI válido (7-8 dígitos).",
            timer: 3000,
            timerProgressBar: true,
            showConfirmButton: false,
          });
          return;
        }

        try {
          // Verifica si el CI y espe existen
          const response = await fetch("/check_ci", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ ci, espe }), // Incluye 'espe' en la solicitud
          });

          const data = await response.json();

          if (data.error) {
            Swal.fire({
              icon: "error",
              title: "Error",
              text: data.error,
              timer: 3000,
              timerProgressBar: true,
              showConfirmButton: false,
            });
          } else if (!data.existe) {
            Swal.fire({
              icon: "error",
              title: "Error",
              text: "El CI proporcionado no existe.",
              timer: 3000,
              timerProgressBar: true,
              showConfirmButton: false,
            });
          } else if (data.espe !== espe) {
            // Mensaje si el CI existe pero con una especialidad diferente
            Swal.fire({
              icon: "error",
              title: "Error",
              text: `El CI proporcionado ya pertenece a la especialidad: ${data.espe}.`,
              timer: 3000,
              timerProgressBar: true,
              showConfirmButton: false,
            });
          } else {
            // Muestra mensaje de confirmación antes de eliminar
            Swal.fire({
              title: "¿Estás seguro?",
              text: "Una vez eliminado, no podrás recuperar este alumno.",
              icon: "warning",
              showCancelButton: true,
              confirmButtonColor: "#3085d6",
              cancelButtonColor: "#d33",
              confirmButtonText: "Sí, eliminar",
              cancelButtonText: "Cancelar",
            }).then((result) => {
              if (result.isConfirmed) {
                // Envía el formulario de eliminación
                document.getElementById("deleteForm").submit(); // Asegúrate de tener un formulario con ID 'deleteForm' para manejar la eliminación
              }
            });
          }
        } catch (error) {
          console.error("Error:", error);
          Swal.fire({
            icon: "error",
            title: "Error de servidor",
            text: "Hubo un problema al verificar el CI. Por favor, intente nuevamente.",
            timer: 3000,
            timerProgressBar: true,
            showConfirmButton: false,
          });
        }
      }

      async function validar_alumno(event) {
    event.preventDefault(); // Previene el envío automático del formulario

    // Validar campos vacíos y nombres
    if (!validar_campos_vacios() || !validar_nombre_apellido()) {
        return; // Si alguna validación falla, no envíes el formulario
    }

    const ci = document.getElementById("ci").value.trim();
    const email = document.getElementById("correo_encargado").value.trim();
    const correoEncargado2Element = document.getElementById("correo_encargado_2");
    const email2 = correoEncargado2Element ? correoEncargado2Element.value.trim() : null;
    const formMode = document.getElementById("form_mode").value; // Obtener el modo del formulario
    const espe = document.getElementById("espe").value;

    // Validar longitud del CI
    if (ci.length < 7 || ci.length > 8) {
        Swal.fire({
            icon: "error",
            title: "Error",
            text: "El CI debe tener entre 7 y 8 caracteres.",
            timer: 3000,
            showConfirmButton: false,
            timerProgressBar: true,
        });
        return; // Detiene el proceso si la longitud no es válida
    }

    // Validar que el CI sea numérico
    if (!/^\d+$/.test(ci)) {
        Swal.fire({
            icon: "error",
            title: "Error",
            text: "El CI debe ser numérico.",
            timer: 3000,
            showConfirmButton: false,
            timerProgressBar: true,
        });
        return; // Detiene el proceso si el CI no es numérico
    }

    // Validar correo electrónico principal
    if (!validarEmail(email)) {
        Swal.fire({
            icon: "error",
            title: "Error",
            text: "El correo electrónico ingresado no es válido.",
            timer: 3500,
            showConfirmButton: false,
            timerProgressBar: true,
        });
        return; // Detiene el proceso si el correo electrónico no es válido
    }

    // Validar correo electrónico adicional solo si está presente y no está vacío
    if (correoEncargado2Element && email2 && !validarEmail(email2)) {
        Swal.fire({
            icon: "error",
            title: "Error",
            text: "El correo electrónico adicional ingresado no es válido.",
            timer: 3500,
            showConfirmButton: false,
            timerProgressBar: true,
        });
        return; // Detiene el proceso si el correo electrónico adicional no es válido
    }

    try {
        // Enviar solicitud para verificar el CI y la especialidad
        const response = await fetch("/check_ci", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ ci, espe }), // Incluye la especialidad en la solicitud
        });
        const data = await response.json();

        if (data.existe) {
            if (data.espe !== espe) {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: `El CI introducido ya pertenece a la especialidad: ${data.espe}.`,
                    timer: 3000,
                    showConfirmButton: false,
                    timerProgressBar: true,
                });
                return; // Detiene el proceso si el CI ya existe en otra especialidad
            }

            if (formMode === "add") {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: "El CI ya existe en el sistema.",
                    timer: 3000,
                    showConfirmButton: false,
                    timerProgressBar: true,
                });
                return; // Detiene el proceso si el CI ya existe
            }
        }

        // Si estás en modo de edición y el CI no existe, mostrar error
        if (formMode === "edit" && !data.existe) {
            Swal.fire({
                icon: "error",
                title: "Error",
                text: "El CI que intentas modificar no existe en el sistema.",
                timer: 3000,
                showConfirmButton: false,
                timerProgressBar: true,
            });
            return; // Detiene el proceso si el CI no existe
        }

        // Si todas las validaciones son correctas, enviar el formulario
        Swal.fire({
            icon: "success",
            title: formMode === "add" ? "Éxito" : formMode === "edit" ? "Actualización exitosa" : "Operación realizada",
            text: formMode === "add" ? "Alumno añadido con éxito." : "Alumno modificado con éxito.",
            timer: 3000,
            showConfirmButton: false,
            timerProgressBar: true,
        }).then(() => {
            document.getElementById("studentForm").submit(); // Envía el formulario después de la alerta
        });
    } catch (error) {
        console.error("Error al validar el CI:", error);
        Swal.fire({
            icon: "error",
            title: "Error",
            text: "Error en la validación del CI.",
            timer: 3000,
            showConfirmButton: false,
            timerProgressBar: true,
        });
    }
}


      
    </script>
  </body>
</html>
